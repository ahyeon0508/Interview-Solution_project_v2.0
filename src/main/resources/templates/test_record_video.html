<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

</head>
<body>
<!--    <div>-->
<!--        <button class="recordButton" onclick="startRecording()">Recording</button>-->
<!--        <button class="stopButton" onclick="stopRecording()">Stop</button>-->
<!--    </div>-->
    <button id="start-camera">Start Camera</button>
    <video id="video" width="320" height="240" autoplay></video>
    <button id="start-record">Start Recording</button>
    <button id="stop-record">Stop Recording</button>
    <a id="download-video" download="test.webm">Download Video</a>
</body>

<script language="javascript" type="text/javascript">
    let camera_button = document.querySelector("#start-camera");
    let video = document.querySelector("#video");
    let start_button = document.querySelector("#start-record");
    let stop_button = document.querySelector("#stop-record");
    let download_link = document.querySelector("#download-video");

    let camera_stream = null;
    let media_recorder = null;
    let blobs_recorded = [];

    camera_button.addEventListener('click', async function() {
        camera_stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        video.srcObject = camera_stream;
    });

    start_button.addEventListener('click', function() {
        // set MIME type of recording as video/webm
        media_recorder = new MediaRecorder(camera_stream, { mimeType: 'video/webm' });

        // event : new recorded video blob available
        media_recorder.addEventListener('dataavailable', function(e) {
            blobs_recorded.push(e.data);
        });

        // event : recording stopped & all blobs sent
        media_recorder.addEventListener('stop', function() {
            // create local object URL from the recorded video blobs
            let video_local = URL.createObjectURL(new Blob(blobs_recorded, { type: 'video/webm' }));
            download_link.href = video_local;
        });

        // start recording with each recorded blob having 1 second video
        media_recorder.start(1000);
    });

    stop_button.addEventListener('click', function() {
        media_recorder.stop();
    });
    //         function onVideoFail(e) {
    //             console.log('webcam fail!', e);
    //         };
    //         function hasGetUserMedia() {
    //             // Note: Opera is unprefixed.
    //             return !!(navigator.getUserMedia || navigator.webkitGetUserMedia ||
    //                 navigator.mozGetUserMedia || navigator.msGetUserMedia);
    //         }
    //
    //         if (hasGetUserMedia()) {
    //             // Good to go!
    //         } else {
    //             alert('getUserMedia() is not supported in your browser');
    //         }
    //
    //         window.URL = window.URL || window.webkitURL;
    //         navigator.getUserMedia  = navigator.getUserMedia ||
    //             navigator.webkitGetUserMedia ||
    //             navigator.mozGetUserMedia ||
    //             navigator.msGetUserMedia;
    //
    //         var video = document.querySelector('video');
    //         var streamRecorder;
    //         var webcamstream;
    //
    //         if (navigator.getUserMedia) {
    //             navigator.getUserMedia({audio: true, video: true}, function(stream) {
    //                 video.src = window.URL.createObjectURL(stream);
    //                 webcamstream = stream;
    // //  streamrecorder = webcamstream.record();
    //             }, onVideoFail);
    //         } else {
    //             alert ('failed');
    //         }
    //
    //         function startRecording() {
    //             console.log("start")
    //             streamRecorder = webcamstream.record();
    //             setTimeout(stopRecording, 10000);
    //         }
    //         function stopRecording() {
    //             console.log("stop")
    //             streamRecorder.getRecordedData(postVideoToServer);
    //         }
    //         function postVideoToServer(videoblob) {
    //
    //             var data = {};
    //             data.video = videoblob;
    //             data.metadata = 'test metadata';
    //             data.action = "upload_video";
    //             //ajax로 비디오 저장
    //         }
    //         function onUploadSuccess() {
    //             alert ('video uploaded');
    //         }

</script>

</html>